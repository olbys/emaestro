<!DOCTYPE html>
<html>
<head>
  <script src="https://code.jquery.com/jquery-2.1.0.js"></script>

</head>

<title>eMaestro</title>
<meta charset="UTF-8"/>
</head>

<body style="background-color:#d1c2c2;">


<div class="container">
    <div class="row justify-content-center">
        <h1>eMaestro</h1>
    </div>
</div>
</body>


<div id="group">
    <form>
        <div class="form-group">
            <label for="namegroup">Nom de l'ensemble</label>
            <input class="form-control" id="namegroup" type="text"></input>

            <label for="responsable">Responsable de l'ensemble</label>
            <input class="form-control" id="responsable" type="text"></input>

            <label for="groupsize">Nombre de membre</label>
            <input class="form-control" id="groupsize" type="number"></input>

            <label for="currentmembre">Identifiant membre</label>
            <input class="form-control" id="currentmembre" type="number"></input>

        </div>
    </form>
</div>

<label>Membres : </label>
<br>

<div id="membre">
    <form>
        <div class="form-group">

            <label for="namemembre">Nom</label>
            <input class="form-control" id="namemembre" type="text"></input>

            <label for="prenommembre">Prenom</label>
            <input class="form-control" id="prenommembre" type="text"></input>

            <label for="player">Instrument</label>
            <input class="form-control" id="player" type="text"></input>

            <br>
        </div>
    </form>
</div>
<br>
<form>
    <div class="membre">
        <div class="infomembre" id="infomembre">
            <label for="nommusicien">Nom</label>
            <input class="form-control" id="nommusicien" type="text"></input>
            <label for="prenommusicien">Prénom</label>
            <input class="form-control" id="prenommusicien" type="text"></input>
            <label for="instrument">Intrument</label>
            <input class="form-control" id="instrument" type="text"></input>

        </div>
        <div>
            <img src="assetss/images/plus.png" width="50" onclick="add()">
        </div>
    </div>
</form>

<div id="add">
    <button class="btn btn-primary">Ajouter</button>
</div>
<br><br>

<div id="cancel">
    <button class="btn btn-primary">Annuler</button>
</div>
<br>
<div id="save">
    <button class="btn btn-primary">Enregistrer</button>
</div>
<br>
<div id="pageemaestro">
        <input type="button" onclick="window.location.href = 'emaestro.html';" value="Accéder aux morceaux"/>
</div>



<script>

    var group;
    var ensembleTemplate = {
        namegroup: "Harmonie",
        responsable: "Chef Machin",
        groupsize: 3,
        currentmembre: 1,
        membres: []
    };

    var firstMusicienTemplate = {
        nom: "Aaa",
        prenom: "Aaa",
        instrument: "guitare"
    };

    var otherMembreTemplate = {
        nom: "",
        prenom: "",
        instrument: ""
    };

    $(function () {
        group = instantiateGroup(ensembleTemplate, firstMusicienTemplate);
        instantiateDOMGroup(group);
    });

    function cancelGroup() {
        group = instantiateGroup(ensembleTemplate, firstMusicienTemplate);
        instantiateDOMGroup(group);
    };
    $("div#cancel button").click(cancelGroup);

    function instantiateGroup(ensembleTemplate, firstMusicienTemplate) {
        var group = JSON.parse(JSON.stringify(ensembleTemplate));
        group.membres[1] = JSON.parse(JSON.stringify(firstMusicienTemplate));
        return group;
    };

    function add() {
        var infoMusicien = ('<label for="nommusicien">Nom</label>' + '<input class="form-control" id="nommusicien" type="text"></input>' +
        ' <label for="prenommusicien">Prénom</label>' + '<input class="form-control" id="prenommusicien" type="text"></input>' +
        '<label for="instrument">Intrument</label>' + '<input class="form-control" id="instrument" type="text"></input>' );
        document.getElementById("add").innerHTML = infoMusicien;
    };
    $("#add button").click(add);

    function instantiateDOMGroup(aGroup) {
        $("div#group input#namegroup").val(aGroup.namegroup);
        $("div#group input#responsable").val(aGroup.responsable);
        $("div#group input#membres").val(aGroup.membres);
        $("div#group input#groupsize").val(aGroup.groupsize);
        $("div#group input#currentmembre").val(aGroup.currentmembre);

        instantiateDOMCurrentMembre(aGroup, aGroup.currentmembre);
    };

    function instantiateDOMCurrentMembre(aGroup, currentmembreNum) {
        $("div#membre input#namemembre").attr("value", aGroup.membres[currentmembreNum].nom);
        $("div#membre input#prenommembre").attr("value", aGroup.membres[currentmembreNum].prenom);
        $("div#membre input#player").attr("value", aGroup.membres[currentmembreNum].instrument);
    }

    function saveGroup() {
        var fileName = $("div#group input#namegroup").val();
        var req = new XMLHttpRequest();
        var fileContent = JSON.stringify(group);

        req.onreadystatechange = function (event) {
            if (this.readyState === XMLHttpRequest.DONE) {
                if (this.status === 200) {
                    console.log("Réponse reçue: %s", this.responseText);
                } else {
                    console.log("Status de la réponse: %d (%s)",
                        this.status, this.statusText);
                }
            }
        };
        req.open("PUT", "http://localhost:8000/Ensemble/" + fileName, true);
        req.send(fileContent);
    };
    $("#save button").click(saveGroup);


    $("#groupsize").change(setGroupSize);
    function setGroupSize() {
        group.groupsize = $("#groupsize").val();
    };

    function setNameGroup() {
        group.namegroup = $("#namegroup").val();
    };
    $("#namegroup").change(setNameGroup);

    function setResponsable() {
        group.responsable = $("#responsable").val();
    };
    $("#responsable").change(setResponsable);


    function setCurrentMembre() {
        group.currentmembre = $("#currentmembre").val();
        console.log("Current membre affiché: " + group.currentmembre);
        instantiateDOMCurrentMembre(group, group.currentmembre);
    };
    $("#currentmembre").change(setCurrentMembre);

    /*    function setMembres() {
            group.membres = $("#membres").val();
        };
        $("#membres").change(setMembres);*/

    function setNom() {
        group.membres[group.currentmembre].nom = $("#namemembre").val();
    };
    $("#namemembre").change(setNom);

    function setPrenom() {
        group.membres[group.currentmembre].prenom = $("#prenommembre").val();
    };
    $("#prenommembre").change(setPrenom);

    function setInstrument() {
        group.membres[group.currentmembre].instrument = $("#player").val();
    };
    $("#player").change(setInstrument);




</script>

</html>
